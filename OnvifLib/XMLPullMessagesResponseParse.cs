using System;
using System.Collections.Generic;
using System.Text;
using System.Xml.Linq;
using System.Linq;
using System.Diagnostics;
using System.Xml.Serialization;
using OnvifLib.Models;
using System.IO;

namespace OnvifLib
{
    public class XMLPullMessagesResponseParse
    {
        public const string TestString = "<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://www.w3.org/2003/05/soap-envelope\" xmlns:SOAP-ENC=\"http://www.w3.org/2003/05/soap-encoding\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:wsa=\"http://schemas.xmlsoap.org/ws/2004/08/addressing\" xmlns:wsdd=\"http://schemas.xmlsoap.org/ws/2005/04/discovery\" xmlns:chan=\"http://schemas.microsoft.com/ws/2005/02/duplex\" xmlns:wsa5=\"http://www.w3.org/2005/08/addressing\" xmlns:xmime=\"http://tempuri.org/xmime.xsd\" xmlns:xop=\"http://www.w3.org/2004/08/xop/include\" xmlns:wsrfbf=\"http://docs.oasis-open.org/wsrf/bf-2\" xmlns:wstop=\"http://docs.oasis-open.org/wsn/t-1\" xmlns:tt=\"http://www.onvif.org/ver10/schema\" xmlns:ns3=\"http://www.onvif.org/ver10/pacs\" xmlns:wsrfr=\"http://docs.oasis-open.org/wsrf/r-2\" xmlns:ns1=\"http://www.onvif.org/ver10/actionengine/wsdl\" xmlns:ns2=\"http://www.onvif.org/ver10/accesscontrol/wsdl\" xmlns:ns4=\"http://www.onvif.org/ver10/doorcontrol/wsdl\" xmlns:tad=\"http://www.onvif.org/ver10/analyticsdevice/wsdl\" xmlns:daae=\"http://www.onvif.org/ver20/analytics/wsdl/AnalyticsEngineBinding\" xmlns:dare=\"http://www.onvif.org/ver20/analytics/wsdl/RuleEngineBinding\" xmlns:tan=\"http://www.onvif.org/ver20/analytics/wsdl\" xmlns:dn=\"http://www.onvif.org/ver10/network/wsdl\" xmlns:ter=\"http://www.onvif.org/ver10/error\" xmlns:tds=\"http://www.onvif.org/ver10/device/wsdl\" xmlns:tev=\"http://www.onvif.org/ver10/events/wsdl\" xmlns:wsnt=\"http://docs.oasis-open.org/wsn/b-2\" xmlns:timg=\"http://www.onvif.org/ver20/imaging/wsdl\" xmlns:tls=\"http://www.onvif.org/ver10/display/wsdl\" xmlns:tmd=\"http://www.onvif.org/ver10/deviceIO/wsdl\" xmlns:tptz=\"http://www.onvif.org/ver20/ptz/wsdl\" xmlns:trc=\"http://www.onvif.org/ver10/recording/wsdl\" xmlns:trp=\"http://www.onvif.org/ver10/replay/wsdl\" xmlns:trt=\"http://www.onvif.org/ver10/media/wsdl\" xmlns:trv=\"http://www.onvif.org/ver10/receiver/wsdl\" xmlns:tse=\"http://www.onvif.org/ver10/search/wsdl\" xmlns:tns1=\"http://www.onvif.org/ver10/topics\" xmlns:tnshik=\"http://www.hikvision.com/2011/event/topics\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:wsse=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd\" xmlns:wsu=\"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd\"><SOAP-ENV:Header><wsa:MessageID>urn:uuid:2b57734a-71f2-4441-901c-7db6725f8542</wsa:MessageID><wsa5:ReplyTo SOAP-ENV:mustUnderstand=\"true\"><wsa5:Address>http://www.w3.org/2005/08/addressing/anonymous</wsa5:Address></wsa5:ReplyTo><wsa5:To SOAP-ENV:mustUnderstand=\"true\">http://192.168.2.124/onvif/Events</wsa5:To><wsa5:Action SOAP-ENV:mustUnderstand=\"true\">http://www.onvif.org/ver10/events/wsdl/EventPortType/GetEventPropertiesResponse</wsa5:Action></SOAP-ENV:Header><SOAP-ENV:Body><tev:GetEventPropertiesResponse><tev:TopicNamespaceLocation>http://www.onvif.org/onvif/ver10/topics/topicns.xml</tev:TopicNamespaceLocation><wsnt:FixedTopicSet>true</wsnt:FixedTopicSet><wstop:TopicSet><tns1:VideoSource wstop:topic=\"true\"><tns1:MotionAlarm wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"Source\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"State\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></tns1:MotionAlarm><tns1:ImageTooBlurry wstop:topic=\"true\"><tns1:ImagingService wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"Source\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"State\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></tns1:ImagingService></tns1:ImageTooBlurry><tns1:GlobalSceneChange wstop:topic=\"true\"><tns1:ImagingService wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"Source\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"State\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></tns1:ImagingService></tns1:GlobalSceneChange></tns1:VideoSource><tns1:Device wstop:topic=\"true\"><Trigger wstop:topic=\"true\"><tnshik:AlarmIn wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"AlarmInToken\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"State\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></tnshik:AlarmIn><DigitalInput wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"InputToken\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"LogicalState\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></DigitalInput><Relay wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"RelayToken\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"LogicalState\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></Relay></Trigger><HardwareFailure wstop:topic=\"true\"><tnshik:HardDiskFull wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"HardDiskNo\" Type=\"xs:int\"/></tt:Source></tt:MessageDescription></tnshik:HardDiskFull><tnshik:HardDiskError wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"HardDiskNo\" Type=\"xs:int\"/></tt:Source></tt:MessageDescription></tnshik:HardDiskError><StorageFailure wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Failed\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></StorageFailure></HardwareFailure><tnshik:Network wstop:topic=\"true\"><tnshik:EthernetBroken wstop:topic=\"true\"><tnshik:IPAddrConflict wstop:topic=\"true\"></tnshik:IPAddrConflict></tnshik:EthernetBroken></tnshik:Network></tns1:Device><tns1:UserAlarm wstop:topic=\"true\"><tnshik:IllegalAccess wstop:topic=\"true\"></tnshik:IllegalAccess></tns1:UserAlarm><tns1:RuleEngine wstop:topic=\"true\"><tns1:CellMotionDetector wstop:topic=\"true\"><tns1:Motion wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"VideoSourceConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"VideoAnalyticsConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"Rule\" Type=\"xs:string\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"IsMotion\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></tns1:Motion></tns1:CellMotionDetector><tns1:LineDetector wstop:topic=\"true\"><tns1:Crossed wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"VideoSourceConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"VideoAnalyticsConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"Rule\" Type=\"xs:string\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"ObjectId\" Type=\"xs:integer\"/></tt:Data></tt:MessageDescription></tns1:Crossed></tns1:LineDetector><tns1:FieldDetector wstop:topic=\"true\"><tns1:ObjectsInside wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"VideoSourceConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"VideoAnalyticsConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"Rule\" Type=\"xs:string\"/></tt:Source><tt:Key><tt:SimpleItemDescription Name=\"ObjectId\" Type=\"xs:integer\"/></tt:Key><tt:Data><tt:SimpleItemDescription Name=\"IsInside\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></tns1:ObjectsInside></tns1:FieldDetector><tns1:TamperDetector wstop:topic=\"true\"><tns1:Tamper wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"VideoSourceConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"VideoAnalyticsConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"Rule\" Type=\"xs:string\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"IsTamper\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></tns1:Tamper></tns1:TamperDetector></tns1:RuleEngine><tns1:AudioAnalytics wstop:topic=\"true\"><tns1:Audio wstop:topic=\"true\"><tns1:DetectedSound wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"AudioSourceConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"AudioAnalyticsConfigurationToken\" Type=\"tt:ReferenceToken\"/><tt:SimpleItemDescription Name=\"Rule\" Type=\"xs:string\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"State\" Type=\"xs:boolean\"/></tt:Data></tt:MessageDescription></tns1:DetectedSound></tns1:Audio></tns1:AudioAnalytics><tns1:Configuration wstop:topic=\"true\"><tns1:Profile wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:Profile\"/></tt:Data></tt:MessageDescription></tns1:Profile><tns1:VideoEncoderConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:VideoEncoderConfiguration\"/></tt:Data></tt:MessageDescription></tns1:VideoEncoderConfiguration><tns1:VideoSourceConfiguration wstop:topic=\"true\"><tns1:MediaService wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:VideoSourceConfiguration\"/></tt:Data></tt:MessageDescription></tns1:MediaService></tns1:VideoSourceConfiguration><tns1:AudioEncoderConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:AudioEncoderConfiguration\"/></tt:Data></tt:MessageDescription></tns1:AudioEncoderConfiguration><tns1:AudioSourceConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:AudioSourceConfiguration\"/></tt:Data></tt:MessageDescription></tns1:AudioSourceConfiguration><tns1:AudioOutputConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:AudioOutputConfiguration\"/></tt:Data></tt:MessageDescription></tns1:AudioOutputConfiguration><tns1:MetadataConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:MetadataConfiguration\"/></tt:Data></tt:MessageDescription></tns1:MetadataConfiguration><tns1:PTZConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:PTZConfiguration\"/></tt:Data></tt:MessageDescription></tns1:PTZConfiguration><tns1:VideoAnalyticsConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:VideoAnalyticsConfiguration\"/></tt:Data></tt:MessageDescription></tns1:VideoAnalyticsConfiguration></tns1:Configuration><tns1:RecordingConfig wstop:topic=\"true\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"><tns1:JobState wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"RecordingJobToken\" Type=\"tt:RecordingJobReference\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"State\" Type=\"xs:string\"/><tt:SimpleItemDescription Name=\"Information\" Type=\"tt:RecordingJobStateInformation\"/></tt:Data></tt:MessageDescription></tns1:JobState><tns1:RecordingJobConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"RecordingJobToken\" Type=\"tt:RecordingJobReference\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:RecordingJobConfiguration\"/></tt:Data></tt:MessageDescription></tns1:RecordingJobConfiguration><tns1:RecordingConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:RecordingReference\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:RecordingConfiguration\"/></tt:Data></tt:MessageDescription></tns1:RecordingConfiguration><tns1:TrackConfiguration wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"RecordingToken\" Type=\"tt:RecordingReference\"/><tt:SimpleItemDescription Name=\"TrackToken\" Type=\"tt:TrackReference\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Configuration\" Type=\"tt:TrackConfiguration\"/></tt:Data></tt:MessageDescription></tns1:TrackConfiguration></tns1:RecordingConfig><tns1:Advancedsecurity wstop:topic=\"true\"><Keystore wstop:topic=\"true\"><KeyStatus wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"false\"><tt:Source><tt:SimpleItemDescription Name=\"KeyID\" Type=\"xs:KeyID\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"OldStatus\" Type=\"xs:KeyStatus\"/><tt:SimpleItemDescription Name=\"NewStatus\" Type=\"xs:KeyStatus\"/></tt:Data></tt:MessageDescription></KeyStatus></Keystore></tns1:Advancedsecurity><tns1:Monitoring wstop:topic=\"true\"><Backup wstop:topic=\"true\"><Last wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Data><tt:SimpleItemDescription Name=\"Status\" Type=\"xs:dateTime\"/></tt:Data></tt:MessageDescription></Last></Backup><ProcessorUsage wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Source><tt:SimpleItemDescription Name=\"Token\" Type=\"tt:ReferenceToken\"/></tt:Source><tt:Data><tt:SimpleItemDescription Name=\"Value\" Type=\"xs:float\"/></tt:Data></tt:MessageDescription></ProcessorUsage><OperatingTime wstop:topic=\"true\"><LastReset wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Data><tt:SimpleItemDescription Name=\"Status\" Type=\"xs:dateTime\"/></tt:Data></tt:MessageDescription></LastReset></OperatingTime><OperatingTime wstop:topic=\"true\"><LastReboot wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Data><tt:SimpleItemDescription Name=\"Status\" Type=\"xs:dateTime\"/></tt:Data></tt:MessageDescription></LastReboot></OperatingTime><OperatingTime wstop:topic=\"true\"><LastClockSynchronization wstop:topic=\"true\"><tt:MessageDescription IsProperty=\"true\"><tt:Data><tt:SimpleItemDescription Name=\"Status\" Type=\"xs:dateTime\"/></tt:Data></tt:MessageDescription></LastClockSynchronization></OperatingTime></tns1:Monitoring></wstop:TopicSet><wsnt:TopicExpressionDialect>http://docs.oasis-open.org/wsn/t-1/TopicExpression/Concrete</wsnt:TopicExpressionDialect><wsnt:TopicExpressionDialect>http://www.onvif.org/ver10/tev/topicExpression/ConcreteSet</wsnt:TopicExpressionDialect><tev:MessageContentFilterDialect>http://www.onvif.org/ver10/tev/messageContentFilter/ItemFilter</tev:MessageContentFilterDialect><tev:MessageContentSchemaLocation>http://www.onvif.org/onvif/ver10/schema/onvif.xsd</tev:MessageContentSchemaLocation></tev:GetEventPropertiesResponse></SOAP-ENV:Body></SOAP-ENV:Envelope>";
        public const string TestString2 = "";
        public const string TestString3 = "";

        public XMLPullMessagesResponseParse() { }

        public Envelope Parse(string xml)
        {
            Envelope result;
            var doc = XDocument.Parse(xml);
            XmlSerializer serializer = new XmlSerializer(typeof(Envelope));
            using (TextReader reader = new StringReader(xml))
            {
                result = (Envelope)serializer.Deserialize(reader);
            }
            return result;

        }
    }
}
